<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOTOMARATON</title>
 <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; margin:0; padding:0; }
    .logo { width: 100%; display: block; cursor:pointer; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 10px; }
    h1 { text-align: center; margin: 5px 0; }
    h2 { text-align: center; margin: 5px 0; }
    .instructions { background: #eef; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    .rules-title { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; display: flex; align-items: center; }
    input[type="checkbox"] { transform: scale(1.5); margin-right: 12px; }
    label { font-size: 16px; }
    #timerDisplay, #pauseTimerDisplay { font-size: 24px; font-weight: bold; margin: 5px; text-align:center; }
    #checklistProgress { margin-top: 10px; font-size: 16px; }
    button { padding: 8px 16px; font-size: 16px; margin: 5px; border: none; border-radius: 6px; color: white; cursor: pointer; }
    #startTimerBtn { background-color: #4CAF50; }
    #pauseBtn { background-color: #888; }
    #resetTimerBtn { background-color: #f44336; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #pauseTimerDisplay { color: red; }
  </style>
  
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
  <!-- Logotypen fungerar nu som "Sl√§pp sp√§rrar"-knapp -->
  <img src="NORDLO.png" alt="Logo" class="logo" id="logoBtn">

  <div class="container">
    <h1>FOTOMARATON</h1>
    <h2>Lloret de Mar 2025</h2>

    <div class="instructions">
      <div class="rules-title">REGLER</div>
      <p>- Alla i laget ska synas p√• alla bilderna.</p>
      <p>- En person m√•ste alltid utf√∂ra samma sak p√• alla bilder. (Gapa/st√• √•t fel h√•ll eller n√•t annat fyndigt.)</p>
      <p>- Laget ska l√§mna in minst 15 bilder.</p>
      <p>- Laget m√•ste vara tillbaka exakt 75 minuter efter startsignalen.</p>
      <p>- H√ÖLL TIDEN!.</p>
    </div>

    <div style="text-align:center; margin-bottom: 20px;">
      <div id="timerDisplay"></div>
      <div id="warningMessage" style="display:none; text-align:center; font-size:28px; font-weight:bold; color:red; margin-top:10px;">
  ‚è∞ Mindre √§n 5 minuter kvar ‚Äì skynda er!
</div>

<div id="endMessage" style="display:none; text-align:center; font-size:20px; font-weight:bold; color:red; margin-top:15px;">
  üö® T√§vlingen √§r avslutad! üö®
</div>
      <div id="pauseTimerDisplay"></div>
      <div id="checklistProgress">0% slutf√∂rt</div>
      <button id="startTimerBtn">Starta t√§vlingen üèÅ</button>
      <button id="pauseBtn" disabled>Pausa 10 min üí§</button>
      <button id="resetTimerBtn">F√∂rl√§ng tiden ‚è±Ô∏è</button>
    </div>

    <ul id="checklist" style="display:none;"></ul>
  </div>
<!-- Ljudfiler -->
<audio id="kazooSound" src="Kazoo.mp3" preload="metadata"></audio>
<audio id="alarmSound" src="Alarm.mp3" preload="metadata"></audio>
<audio id="endMusic" src="endmusic.mp3" preload="metadata"></audio>

  <script>
    // ---- Konfig ----
    const TOTAL_MINUTES = 6;          // Byt till 11 f√∂r test
    const PAUSE_MINUTES = 1;

    // ---- Element ----
    const checklist = document.getElementById('checklist');
    const checklistProgress = document.getElementById('checklistProgress');
    const timerDisplay = document.getElementById('timerDisplay');
    const pauseTimerDisplay = document.getElementById('pauseTimerDisplay');
    const startBtn = document.getElementById('startTimerBtn');
    const resetBtn = document.getElementById('resetTimerBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const logoBtn = document.getElementById('logoBtn');

    // ---- State ----
    const totalDuration = TOTAL_MINUTES * 60 * 1000;
    const pauseDuration = PAUSE_MINUTES * 60 * 1000;
    let mainTimer = null;
    let pauseTimer = null;
    let timerStarted = false;
    let pausedOnce = false;

    // ---- Checklista ----
    const items = [
      'En gruppbild i det minsta utrymmet ni f√•r plats i',
      'Bygg n√•got tillsammans (Fri tolkning. G√∂r en m√§nsklig pyramid, bygg ett sandslott eller hitta en byggarbetsplats.)',
      'En ov√§ntad v√§nskap...!',
      'Alla i laget g√∂r samma sak (tex Alla i luften, alla p√• huk, "walk like an egyptian...")',
      'En ‚Äúolycka‚Äù p√• semestern üò±',
      'Tema "Havet" üåä',
      'F√∂re & efter ‚Äì ta tv√• bilder bredvid varandra: en ‚Äúseri√∂s aff√§rsbild‚Äù och en ‚Äúsemesterbild‚Äù p√• samma plats.',
      'Skriv NORDLO i sanden p√• stranden och ta en gruppbild ‚ù§Ô∏è',
      'Kl√§m ihop n√•t j√§ttestort',
      'Det minsta och st√∂rsta ni hittar som ryms i en hand',
      'G√∂r honn√∂r framf√∂r en font√§n! ü´°',
      'Krama en palm!',
      'G√∂r tummen upp framf√∂r Iglesia de San Rom√°n üëç',
      'Asgarva! ü§£ü§£ü§£',
      'Turistf√§llan ‚Äì posera framf√∂r n√•got helt vardagligt (t.ex. en soptunna) som om det vore stadens st√∂rsta sev√§rdhet',
      'Alla √§r v√§nda bort fr√•n kameran',
      'Ta en gruppbild med en katt/hund/valfritt djur',
      'Peta p√• en motorcykel. En ska se glad ut, alla andra f√∂rskr√§ckta',
      'Ramla! (roliga gatan fram)',
      'Ha en livlig argumentation',
      'Spela fotboll',
      '√Ñt n√•t litet, men gapa som att det √§r n√•t j√§ttestort',
      '√Öterskapa skivomslaget till Beatles - Abbey road üéµ',
      'Tugga tuggummi och bl√•s en stor bubbla',
      'Ta en bild med en udda hatt üé©'
    ];

    items.forEach((item,index)=>{
      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type='checkbox';
      checkbox.id=`task${index+1}`;
      if(localStorage.getItem(checkbox.id)==='true') checkbox.checked=true;
      checkbox.addEventListener('change',()=>{
        localStorage.setItem(checkbox.id,checkbox.checked);
        updateChecklistProgress();
        if(checkbox.checked && /Mobi|Android/i.test(navigator.userAgent)){
          confetti({particleCount:1000, spread:360, scalar:1.5, ticks:400,origin: { x: 0.5, y: 0.3 }});
        }
      });
      const label = document.createElement('label');
      label.htmlFor=checkbox.id;
      label.innerText=item;
      li.appendChild(checkbox);
      li.appendChild(label);
      checklist.appendChild(li);
    });

    function updateChecklistProgress(){
      const cb = checklist.querySelectorAll('input[type="checkbox"]');
      const total = cb.length;
      const checked = Array.from(cb).filter(x=>x.checked).length;
      checklistProgress.innerText = `${Math.round((checked/total)*100)}% slutf√∂rt`;
    }
    updateChecklistProgress();

    // ---- Hj√§lpfunktioner ----
    function formatTime(seconds){
      const m=Math.floor(seconds/60), s=seconds%60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
    function preventReload(on){
      if(on){
        window.addEventListener('beforeunload', blockUnload);
      } else {
        window.removeEventListener('beforeunload', blockUnload);
      }
    }
    function blockUnload(e){ e.preventDefault(); e.returnValue=''; }
    function showChecklist(show){ checklist.style.display = show ? 'block' : 'none'; }

    function getNow(){ return Date.now(); }

    // Ber√§kna huvudtimer-v√§rdet s√• som det var vid pausens start
    function computeRemainingAt(tsMs){
      const timerStart = getNum(LS.timerStart);
      const totalPaused = getNum(LS.totalPaused);
      const elapsedAtTs = Math.max(0, tsMs - timerStart - totalPaused);
      return Math.max(0, Math.ceil((totalDuration - elapsedAtTs)/1000));
    }

    const LS = {
      timerStart: 'timerStart',
      totalPaused: 'totalPaused',
      pauseStart: 'pauseStart',
      pausedOnce: 'pausedOnce',
      doneWarned: 'doneWarned'
    };

    function getNum(key){ return Number(localStorage.getItem(key) || 0); }
    function setNum(key,val){ localStorage.setItem(key,String(val)); }
    function clr(key){ localStorage.removeItem(key); }

    // ---- Huvudtimer ----
function startMainTick(){ clearInterval(mainTimer); mainTimer = setInterval(()=>{ const timerStart = getNum(LS.timerStart); const totalPaused = getNum(LS.totalPaused); const elapsed = Math.max(0, getNow() - timerStart - totalPaused); let remainingSec = Math.ceil((totalDuration - elapsed)/1000); if(remainingSec <= 0){ remainingSec = 0; clearInterval(mainTimer); if(!localStorage.getItem(LS.doneWarned)){ localStorage.setItem(LS.doneWarned,'1'); // Visa slutmeddelande const endMsg = document.getElementById("endMessage"); endMsg.textContent = "T√§vlingen √§r avslutad"; endMsg.style.display = "block"; // Spela upp slutmusiken const endMusic = document.getElementById("endMusic"); if (endMusic) { try { endMusic.currentTime = 0; const p = endMusic.play(); if (p && typeof p.then === 'function') { p.catch(()=>{ /* Autoplay kan blockeras av webbl√§saren */ }); } } catch(e) { /* Ignorera fel vid uppspelning */ } } } clr(LS.pauseStart); clr(LS.pausedOnce); preventReload(false); pauseBtn.disabled = false; pauseBtn.style.backgroundColor = "#4CAF50"; timerStarted = false; // S√§tt display vid 0 och d√∂lj varningen timerDisplay.innerText = formatTime(0); const warn = document.getElementById("warningMessage"); if (warn) warn.style.display = "none"; return; // Avsluta tick-funktionen n√§r tiden √§r slut } // üî¥ 5-minutersvarning (endast text, inget ljud) if(remainingSec <= 5*60 && remainingSec > 0){ document.getElementById("warningMessage").style.display = "block"; } else { document.getElementById("warningMessage").style.display = "none"; } timerDisplay.innerText = formatTime(remainingSec); }, 1000); }
    function startMain(){
      if(timerStarted) return;
      timerStarted = true;

      document.getElementById("kazooSound").play();

      startBtn.disabled = true;
      startBtn.style.backgroundColor = "#888";
      pauseBtn.disabled = false;
      pauseBtn.style.backgroundColor = "#4CAF50";
      showChecklist(true);
      preventReload(true);

      if(!localStorage.getItem(LS.timerStart)){
        setNum(LS.timerStart, getNow());
        setNum(LS.totalPaused, 0);
        clr(LS.pauseStart);
        clr(LS.doneWarned);
      }

      pausedOnce = localStorage.getItem(LS.pausedOnce) === 'true';
      startMainTick();
    }

    // ---- Paus ----
    function startPause(){
      if(!timerStarted) return;
      if(localStorage.getItem(LS.pauseStart)) return;
      if(localStorage.getItem(LS.pausedOnce) === 'true') return;

      if(!confirm("üö®‚ö†Ô∏èVARNING!‚ö†Ô∏èüö®\n\nDenna godk√§nda pausknapp g√•r att anv√§nda endast EN g√•ng!\n\n√Ñr du HELT S√ÑKER p√• att du vill pausa?")) return;

      localStorage.setItem(LS.pausedOnce, 'true');
      pausedOnce = true;

      pauseBtn.disabled = true;
      pauseBtn.style.backgroundColor = "#888";
      showChecklist(false);
      preventReload(true);

      setNum(LS.pauseStart, getNow());
      clearInterval(mainTimer);

      // Frys huvudtimer-v√§rdet (s√• att det visas √§ven vid reload under paus)
      const remainingAtPause = computeRemainingAt(getNum(LS.pauseStart));
      timerDisplay.innerText = formatTime(remainingAtPause);

      // Starta pausnedr√§kning
      clearInterval(pauseTimer);
      let remaining = Math.ceil(pauseDuration/1000);
      pauseTimerDisplay.innerText = "Paus " + formatTime(remaining);
      pauseTimer = setInterval(()=>{
        remaining--;
        if(remaining <= 0){
          clearInterval(pauseTimer);
          pauseTimerDisplay.innerText = '';
          endPauseAndResume();
        } else {
          pauseTimerDisplay.innerText = "Paus " + formatTime(remaining);
        }
      }, 1000);
    }

    function endPauseAndResume(){
      const pauseStart = getNum(LS.pauseStart);
      if(pauseStart){
        const pauseElapsed = getNow() - pauseStart;
        const totalPaused = getNum(LS.totalPaused) + pauseElapsed;
        setNum(LS.totalPaused, totalPaused);
      }
      clr(LS.pauseStart);


      showChecklist(true);
      startMainTick();
      preventReload(true);
    }

    // ---- Knappar ----
    startBtn.addEventListener('click', startMain);
    pauseBtn.addEventListener('click', startPause);

    resetBtn.addEventListener('click', () => {
      const alarm = document.getElementById("alarmSound");
      alarm.play();
      setTimeout(() => {
        alert("üö®APP-APP-APP!üö®\nF√∂rs√∂k inte fuska!\n\nNi har tryckt p√• en f√∂rbjuden knapp!‚ö†Ô∏è\n\nEtt meddelande har skickats till ledningsgruppen!");
      }, 200);
    });

    // ---- Sl√§pp sp√§rrar via loggan ----
    logoBtn.addEventListener('click', ()=> {
      if(!confirm("Vill du sl√§ppa alla sp√§rrar och nollst√§lla?")) return;

      clearInterval(mainTimer);
      clearInterval(pauseTimer);
      clr(LS.timerStart);
      clr(LS.totalPaused);
      clr(LS.pauseStart);
      clr(LS.pausedOnce);
      clr(LS.doneWarned);

      timerStarted = false;
      pausedOnce = false;
      timerDisplay.innerText = formatTime(TOTAL_MINUTES*60);
      pauseTimerDisplay.innerText = '';
      showChecklist(false);
      preventReload(false);

      startBtn.disabled = false;
      startBtn.style.backgroundColor = "#4CAF50";
      pauseBtn.disabled = true;
      pauseBtn.style.backgroundColor = "#888";

      const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb=>{
        cb.checked = false;
        localStorage.setItem(cb.id, 'false');
      });
      updateChecklistProgress();
    });

    // ---- Init ----
    (function initFromStorage(){
      if(localStorage.getItem(LS.timerStart)){
        timerStarted = true;
        startBtn.disabled = true;
        startBtn.style.backgroundColor = "#888";
        pauseBtn.disabled = localStorage.getItem(LS.pausedOnce)==='true';
        pauseBtn.style.backgroundColor = pauseBtn.disabled ? "#888" : "#4CAF50";

        const inPause = !!localStorage.getItem(LS.pauseStart);
        showChecklist(!inPause);
        preventReload(true);

        if(inPause){
          // Visa huvudtimer-v√§rdet s√• som det var vid pausens start
          const pauseStartMs = getNum(LS.pauseStart);
          const remainingMainAtPause = computeRemainingAt(pauseStartMs);
          timerDisplay.innerText = formatTime(remainingMainAtPause);

          // √Öterst√§ll pausnedr√§kning
          const elapsed = getNow() - pauseStartMs;
          let remaining = Math.max(0, Math.ceil((pauseDuration - elapsed)/1000));
          pauseTimerDisplay.innerText = remaining>0 ? ("Paus " + formatTime(remaining)) : '';
          clearInterval(pauseTimer);
          if(remaining>0){
            pauseTimer = setInterval(()=>{
              remaining--;
              if(remaining<=0){
                clearInterval(pauseTimer);
                pauseTimerDisplay.innerText='';
                endPauseAndResume();
              }else{
                pauseTimerDisplay.innerText="Paus " + formatTime(remaining);
              }
            },1000);
          }else{
            endPauseAndResume();
          }
        }else{
          startMainTick();
        }
      }else{
        timerDisplay.innerText = formatTime(TOTAL_MINUTES*60);
        showChecklist(false);
        preventReload(false);
        pauseBtn.disabled = true;
        pauseBtn.style.backgroundColor = "#888";
      }
    })();
  </script>
</body>
</html>
