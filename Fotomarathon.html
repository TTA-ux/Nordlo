<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOTOMARATHON</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; margin:0; padding:0; }
    .logo { width: 100%; display: block; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 10px; }
    h2 { text-align: center; margin: 5px 0; }
    .instructions { background: #eef; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    .rules-title { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; display: flex; align-items: center; }
    input[type="checkbox"] { transform: scale(1.5); margin-right: 12px; }
    label { font-size: 16px; }
    #timerDisplay, #pauseTimerDisplay { font-size: 24px; font-weight: bold; margin: 5px; text-align:center; }
    #checklistProgress { margin-top: 10px; font-size: 16px; }
    button { padding: 8px 16px; font-size: 16px; margin: 5px; border: none; border-radius: 6px; background-color: #4CAF50; color: white; cursor: pointer; }
    button:hover { background-color: #45a049; }
    #pauseTimerDisplay { color: red; }
    .hidden { display: none; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
  <img src="NORDLO.png" alt="Logo" class="logo">
  <div class="container">
    <h2>FOTOMARATHON</h2>
    <h2>Lloret de Mar</h2>

    <div class="instructions">
      <div class="rules-title">REGLER</div>
      <p>- Alla i laget ska synas på alla bilderna.</p>
      <p>- En person måste alltid utföra samma sak på alla bilder. Gapa/sträcka upp händerna/stå åt fel håll eller nåt annat fyndigt.</p>
      <p>- Laget måste vara tillbaka exakt 75 minuter efter att startsignalen går.</p>
      <p>(Fotobevis krävs: Gruppbild framför scenen med klockslag synligt.)</p>
    </div>

    <div style="text-align:center; margin-bottom: 20px;">
      <div id="timerDisplay">75:00</div>
      <div id="pauseTimerDisplay"></div>
      <div id="checklistProgress">0% klara</div>
      <button id="startTimerBtn">Starta timer</button>
      <button id="resetTimerBtn">Nollställ timer</button>
      <button id="pauseBtn">Pausa 10 min</button>
    </div>

    <ul id="checklist"></ul>
  </div>

  <script>
    const items = [
      'En gruppbild på det minsta utrymmet ni får plats i',
      'Bygg något tillsammans (Fri tolkning. Gör en mänsklig pyramid, bygg ett sandslott eller hitta en byggarbetsplats.)',
      'En oväntad vänskap...!',
      'Alla i laget gör samma sak (tex Alla i luften, alla på huk, walk like an egyptian...)',
      'En “olycka” på semestern',
      'Havstema',
      'Före & efter – ta två bilder bredvid varandra: en “seriös affärsbild” och en “semesterbild” på samma plats.',
      'Skriv NORDLO i sanden på stranden och ta en gruppbild',
      'Kläm ihop nåt jättestort',
      'Det minsta och största ni hittar, som ryms i en hand',
      'Gör honnör framför en fontän!',
      'Krama en palm!',
      'Gör tummen upp framför Iglesia de San Román',
      'Turistfällan – posera framför något helt vardagligt (t.ex. en soptunna) som om det vore stadens största sevärdhet',
      'Alla är vända bort från kameran',
      'Ta en gruppbild med en katt/hund/valfritt djur',
      'Peta på en motorcykel. En ska se glad ut, alla andra förskräckta',
      'Ramla! (roliga gatan fram)',
      'Ha en livlig argumentation',
      'Spela fotboll',
      'Ät nåt litet, men gapa så att det är nåt jättestort',
      'Återskapa skivomslaget till Beatles - Abbey road'
    ];

    const checklist = document.getElementById('checklist');
    items.forEach((item,index)=>{
      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type='checkbox';
      checkbox.id=`task${index+1}`;
      if(localStorage.getItem(checkbox.id)==='true') checkbox.checked=true;
      checkbox.addEventListener('change',()=>{
        localStorage.setItem(checkbox.id,checkbox.checked);
        updateChecklistProgress();
        if(checkbox.checked && /Mobi|Android/i.test(navigator.userAgent)){
          confetti({particleCount:100, spread:70, origin:{y:0.6}});
        }
      });
      const label = document.createElement('label');
      label.htmlFor=checkbox.id;
      label.innerText=item;
      li.appendChild(checkbox);
      li.appendChild(label);
      checklist.appendChild(li);
    });

    const checklistProgress = document.getElementById('checklistProgress');
    function updateChecklistProgress(){
      const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
      const total = checkboxes.length;
      const checked = Array.from(checkboxes).filter(cb=>cb.checked).length;
      checklistProgress.innerText = `${Math.round((checked/total)*100)}% klara`;
    }
    updateChecklistProgress();

    const timerDisplay = document.getElementById('timerDisplay');
    const pauseTimerDisplay = document.getElementById('pauseTimerDisplay');
    const startBtn = document.getElementById('startTimerBtn');
    const resetBtn = document.getElementById('resetTimerBtn');
    const pauseBtn = document.getElementById('pauseBtn');

    let totalDuration = 75*60*1000;
    let pauseDuration = 10*60*1000;
    let timer, pauseTimer;
    let pausedOnce = localStorage.getItem('pausedOnce')==='true';
    let mainRemaining = totalDuration;

    function formatTime(seconds){ 
      const m=Math.floor(seconds/60), s=seconds%60; 
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`; 
    }

    function startMainTimer(){
      checklist.classList.remove('hidden');
      checklistProgress.classList.remove('hidden');
      if(!localStorage.getItem('timerStart')) localStorage.setItem('timerStart',Date.now());
      clearInterval(timer);
      timer=setInterval(()=>{
        const elapsed = Date.now()-localStorage.getItem('timerStart');
        mainRemaining = Math.ceil((totalDuration-elapsed)/1000);
        if(mainRemaining<=0) {
          mainRemaining=0;
          clearInterval(timer);
          localStorage.removeItem('pausedOnce');
          localStorage.removeItem('timerStart');
          localStorage.removeItem('pauseStart');
          pauseBtn.disabled=false;
        }
        timerDisplay.innerText=formatTime(mainRemaining);
      },1000);
    }

    function startPause(){
      if(pausedOnce) return;
      if(!confirm("OBS! Denna går att använda endast en gång!\nÄr du säker på att du vill pausa?")) return;

      pausedOnce=true;
      localStorage.setItem('pausedOnce','true');

      clearInterval(timer);
      localStorage.setItem('pauseStart',Date.now());
      pauseBtn.disabled=true;

      // Göm checklist och progress under pausen
      checklist.classList.add('hidden');
      checklistProgress.classList.add('hidden');

      let pauseRemaining = pauseDuration/1000;
      pauseTimerDisplay.innerText = "Paus " + formatTime(pauseRemaining);

      pauseTimer = setInterval(()=>{
        pauseRemaining--;
        if(pauseRemaining<=0){
          clearInterval(pauseTimer);
          pauseTimerDisplay.innerText='';
          startMainTimer();
        } else {
          pauseTimerDisplay.innerText = "Paus " + formatTime(pauseRemaining);
        }
      },1000);
    }

    startBtn.addEventListener('click',startMainTimer);
    resetBtn.addEventListener('click',()=>alert("APP-APP-APP!\nFörsök inte fuska!\n\nLedningen har nu fått ett mail om att ni tryckt på knappen!"));
    pauseBtn.addEventListener('click',startPause);
    pauseBtn.addEventListener('touchstart', function(e){ e.preventDefault(); startPause(); }, {passive:false});

    window.addEventListener('load',()=>{
      if(localStorage.getItem('timerStart')) startMainTimer();
      else timerDisplay.innerText = formatTime(totalDuration/1000);

      if(localStorage.getItem('pauseStart')){
        const elapsed = Date.now()-localStorage.getItem('pauseStart');
        if(elapsed<pauseDuration){
          pausedOnce=true;
          pauseBtn.disabled=true;
          clearInterval(timer);
          let pauseRemaining = Math.ceil((pauseDuration-elapsed)/1000);

          // Göm checklist och progress om pausen är aktiv
          checklist.classList.add('hidden');
          checklistProgress.classList.add('hidden');

          pauseTimerDisplay.innerText = "Paus " + formatTime(pauseRemaining);
          pauseTimer=setInterval(()=>{
            pauseRemaining--;
            if(pauseRemaining<=0){
              clearInterval(pauseTimer);
              pauseTimerDisplay.innerText='';
              startMainTimer();
            } else {
              pauseTimerDisplay.innerText = "Paus " + formatTime(pauseRemaining);
            }
          },1000);
        } else {
          localStorage.removeItem('pauseStart');
        }
      }
    });

    window.addEventListener('beforeunload', function (e) {
      const timerRunning = mainRemaining > 0;
      const pauseActive = pauseTimerDisplay.innerText !== '';
      if (timerRunning || pauseActive) {
        e.preventDefault();
        e.returnValue = 'Timer eller paus pågår! Är du säker på att du vill lämna sidan?';
        return 'Timer eller paus pågår! Är du säker på att du vill lämna sidan?';
      }
    });
  </script>
</body>
</html>
