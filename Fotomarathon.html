<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOTOMARATHON</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; margin:0; padding:0; }
    .logo { width: 100%; display: block; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 10px; }
    h2 { text-align: center; margin: 5px 0; }
    .instructions { background: #eef; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    .rules-title { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; display: flex; align-items: center; }
    input[type="checkbox"] { transform: scale(1.5); margin-right: 12px; }
    label { font-size: 16px; }
    #timerDisplay, #pauseTimerDisplay { font-size: 24px; font-weight: bold; margin: 5px; text-align:center; }
    #checklistProgress { margin-top: 10px; font-size: 16px; }
    button { padding: 8px 16px; font-size: 16px; margin: 5px; border: none; border-radius: 6px; color: white; cursor: pointer; }
    #startTimerBtn { background-color: #4CAF50; }
    #pauseBtn { background-color: #888; }
    #resetTimerBtn { background-color: #f44336; }
    #releaseLocksBtn { background-color: #2196F3; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #pauseTimerDisplay { color: red; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
  <img src="NORDLO.png" alt="Logo" class="logo">
  <div class="container">
    <h2>FOTOMARATHON</h2>
    <h2>Lloret de Mar</h2>

    <div class="instructions">
      <div class="rules-title">REGLER</div>
      <p>- Alla i laget ska synas på alla bilderna.</p>
      <p>- En person måste alltid utföra samma sak på alla bilder. Gapa/sträcka upp händerna/stå åt fel håll eller nåt annat fyndigt.</p>
      <p>- Laget måste vara tillbaka exakt 75 minuter efter att startsignalen går.</p>
      <p>(Fotobevis krävs: Gruppbild framför scenen med klockslag synligt.)</p>
    </div>

    <div style="text-align:center; margin-bottom: 20px;">
      <div id="timerDisplay">75:00</div>
      <div id="pauseTimerDisplay"></div>
      <div id="checklistProgress">0% klara</div>
      <button id="startTimerBtn">Starta tävlingen</button>
      <button id="pauseBtn" disabled>Pausa 10 min</button>
      <button id="resetTimerBtn">Nollställ timer</button>
      <button id="releaseLocksBtn">Släpp alla spärrar</button>
    </div>

    <ul id="checklist" style="display:none;"></ul>
  </div>

  <script>
    // ---- Konfig ----
    const TOTAL_MINUTES = 11;          // Huvudtävlingen är 75 minuter
    const PAUSE_MINUTES = 1;          // Pausen är 10 minuter

    // ---- Element ----
    const checklist = document.getElementById('checklist');
    const checklistProgress = document.getElementById('checklistProgress');
    const timerDisplay = document.getElementById('timerDisplay');
    const pauseTimerDisplay = document.getElementById('pauseTimerDisplay');
    const startBtn = document.getElementById('startTimerBtn');
    const resetBtn = document.getElementById('resetTimerBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const releaseBtn = document.getElementById('releaseLocksBtn');

    // ---- State ----
    const totalDuration = TOTAL_MINUTES * 60 * 1000;
    const pauseDuration = PAUSE_MINUTES * 60 * 1000;
    let mainTimer = null;
    let pauseTimer = null;
    let timerStarted = false;
    let pausedOnce = false;

    // ---- Checklista ----
    const items = [
      'En gruppbild på det minsta utrymmet ni får plats i',
      'Bygg något tillsammans (Fri tolkning. Gör en mänsklig pyramid, bygg ett sandslott eller hitta en byggarbetsplats.)',
      'En oväntad vänskap...!',
      'Alla i laget gör samma sak (tex Alla i luften, alla på huk, walk like an egyptian...)',
      'En “olycka” på semestern',
      'Havstema',
      'Före & efter – ta två bilder bredvid varandra: en “seriös affärsbild” och en “semesterbild” på samma plats.',
      'Skriv NORDLO i sanden på stranden och ta en gruppbild',
      'Kläm ihop nåt jättestort',
      'Det minsta och största ni hittar, som ryms i en hand',
      'Gör honnör framför en fontän!',
      'Krama en palm!',
      'Gör tummen upp framför Iglesia de San Román',
      'Turistfällan – posera framför något helt vardagligt (t.ex. en soptunna) som om det vore stadens största sevärdhet',
      'Alla är vända bort från kameran',
      'Ta en gruppbild med en katt/hund/valfritt djur',
      'Peta på en motorcykel. En ska se glad ut, alla andra förskräckta',
      'Ramla! (roliga gatan fram)',
      'Ha en livlig argumentation',
      'Spela fotboll',
      'Ät nåt litet, men gapa så att det är nåt jättestort',
      'Återskapa skivomslaget till Beatles - Abbey road'
    ];

    items.forEach((item,index)=>{
      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type='checkbox';
      checkbox.id=`task${index+1}`;
      if(localStorage.getItem(checkbox.id)==='true') checkbox.checked=true;
      checkbox.addEventListener('change',()=>{
        localStorage.setItem(checkbox.id,checkbox.checked);
        updateChecklistProgress();
        if(checkbox.checked && /Mobi|Android/i.test(navigator.userAgent)){
          confetti({particleCount:100, spread:70, origin:{y:0.6}});
        }
      });
      const label = document.createElement('label');
      label.htmlFor=checkbox.id;
      label.innerText=item;
      li.appendChild(checkbox);
      li.appendChild(label);
      checklist.appendChild(li);
    });

    function updateChecklistProgress(){
      const cb = checklist.querySelectorAll('input[type="checkbox"]');
      const total = cb.length;
      const checked = Array.from(cb).filter(x=>x.checked).length;
      checklistProgress.innerText = `${Math.round((checked/total)*100)}% klara`;
    }
    updateChecklistProgress();

    // ---- Hjälpfunktioner ----
    function formatTime(seconds){
      const m=Math.floor(seconds/60), s=seconds%60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
    function preventReload(on){
      if(on){
        window.addEventListener('beforeunload', blockUnload);
      } else {
        window.removeEventListener('beforeunload', blockUnload);
      }
    }
    function blockUnload(e){ e.preventDefault(); e.returnValue=''; }
    function showChecklist(show){ checklist.style.display = show ? 'block' : 'none'; }

    function getNow(){ return Date.now(); }

    // ---- LocalStorage nycklar ----
    const LS = {
      timerStart: 'timerStart',
      totalPaused: 'totalPaused',
      pauseStart: 'pauseStart',
      pausedOnce: 'pausedOnce',
      fiveMinWarned: 'fiveMinWarned',
      doneWarned: 'doneWarned'
    };

    function getNum(key){ return Number(localStorage.getItem(key) || 0); }
    function setNum(key,val){ localStorage.setItem(key,String(val)); }
    function clr(key){ localStorage.removeItem(key); }

    // ---- Ljud ----
    const alertAudio = new Audio('https://www.soundjay.com/button/beep-07.wav');
    function playAlert(){ alertAudio.currentTime = 0; alertAudio.play(); }

    // ---- Timer ----
    function startMainTick(){
      const startTime = getNum(LS.timerStart) || getNow();
      setNum(LS.timerStart,startTime);
      timerStarted=true;
      preventReload(true);
      showChecklist(true);
      pauseBtn.disabled=false;

      mainTimer = setInterval(()=>{
        let elapsed = (getNow()-startTime) - getNum(LS.totalPaused);
        let remainingSec = Math.max(0, Math.ceil((totalDuration - elapsed)/1000));

        // 10 min varning
        if(remainingSec===600 && !localStorage.getItem('tenMinWarned')){
          localStorage.setItem('tenMinWarned','1');
          playAlert();
          alert('10 minuter kvar av tävlingen!');
        }

        // 5 min varning
        if(remainingSec===300 && !localStorage.getItem(LS.fiveMinWarned)){
          localStorage.setItem(LS.fiveMinWarned,'1');
          playAlert();
          alert('5 minuter kvar av tävlingen!');
        }

        timerDisplay.innerText = formatTime(remainingSec);

        if(remainingSec<=0){
          clearInterval(mainTimer);
          if(!localStorage.getItem(LS.doneWarned)){
            localStorage.setItem(LS.doneWarned,'1');
            playAlert();
            alert('Tävlingen är över!');
          }
          clr(LS.pauseStart);
          clr(LS.pausedOnce);
          preventReload(false);
          pauseBtn.disabled=false;
          pauseBtn.style.backgroundColor="#4CAF50";
          timerStarted=false;
        }
      },1000);
    }

    startBtn.addEventListener('click',()=>{
      if(!timerStarted) startMainTick();
    });

    pauseBtn.addEventListener('click',()=>{
      if(!pausedOnce){
        pausedOnce=true;
        setNum(LS.pausedOnce,1);
        setNum(LS.pauseStart,getNow());
        pauseBtn.disabled=true;
        pauseBtn.style.backgroundColor="#888";

        pauseTimerDisplay.innerText = `Paus: ${PAUSE_MINUTES}:00`;
        let remainingMs = pauseDuration;
        pauseTimer = setInterval(()=>{
          remainingMs -= 1000;
          if(remainingMs<=0){
            clearInterval(pauseTimer);
            pauseTimerDisplay.innerText='';
            let totalPaused = getNum(LS.totalPaused);
            setNum(LS.totalPaused,totalPaused+pauseDuration);
            pauseBtn.disabled=false;
            pauseBtn.style.backgroundColor="#4CAF50";
            alert('Pausen är slut! Tävlingsklockan fortsätter.');
          } else {
            pauseTimerDisplay.innerText=`Paus: ${formatTime(Math.ceil(remainingMs/1000))}`;
          }
        },1000);
      }
    });

    resetBtn.addEventListener('click',()=>{
      if(confirm('Nollställ all timer och paus?')){
        clearInterval(mainTimer);
        clearInterval(pauseTimer);
        clr(LS.timerStart); clr(LS.totalPaused);
        clr(LS.pauseStart); clr(LS.pausedOnce);
        clr(LS.fiveMinWarned); clr(LS.doneWarned); clr('tenMinWarned');
        timerDisplay.innerText=formatTime(TOTAL_MINUTES*60);
        pauseTimerDisplay.innerText='';
        timerStarted=false;
        pauseBtn.disabled=true;
        pauseBtn.style.backgroundColor="#888";
        preventReload(false);
      }
    });

    releaseBtn.addEventListener('click',()=>{
      if(confirm('Släpp alla checkboxar?')){
        items.forEach((_,i)=>clr(`task${i+1}`));
        updateChecklistProgress();
        checklist.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
      }
    });

  </script>
</body>
</html>
