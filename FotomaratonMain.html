
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FOTOMARATON</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f9; margin:0; padding:0; }
    .logo { width: 100%; display: block; }
    .container { max-width: 500px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 10px; }
    h1 { text-align: center; margin: 5px 0; }
    h2 { text-align: center; margin: 5px 0; }
    .instructions { background: #eef; padding: 10px; border-radius: 8px; margin-bottom: 20px; font-size: 14px; }
    .rules-title { text-align: center; font-weight: bold; font-size: 18px; margin-bottom: 10px; }
    ul { list-style: none; padding: 0; }
    li { margin: 10px 0; display: flex; align-items: center; }
    input[type="checkbox"] { transform: scale(1.5); margin-right: 12px; }
    label { font-size: 16px; }
    #timerDisplay, #pauseTimerDisplay { font-size: 24px; font-weight: bold; margin: 5px; text-align:center; }
    #checklistProgress { margin-top: 10px; font-size: 16px; }
    button { padding: 8px 16px; font-size: 16px; margin: 5px; border: none; border-radius: 6px; color: white; cursor: pointer; }
    #startTimerBtn { background-color: #4CAF50; }
    #pauseBtn { background-color: #888; }
    #resetTimerBtn { background-color: #f44336; }
    #releaseLocksBtn { background-color: #2196F3; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }
    #pauseTimerDisplay { color: red; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
  <img src="NORDLO.png" alt="Logo" class="logo">
  <div class="container">
    <h1>FOTOMARATON</h1>
    <h2>Lloret de Mar 2025</h2>

    <div class="instructions">
      <div class="rules-title">REGLER</div>
      <p>- Alla i laget ska synas p√• alla bilderna.</p>
      <p>- En person m√•ste alltid utf√∂ra samma sak p√• alla bilder. (Gapa/str√§cka upp h√§nderna/st√• √•t fel h√•ll eller n√•t annat fyndigt.)</p>
      <p>- Laget m√•ste vara tillbaka exakt 75 minuter efter att startsignalen g√•r.</p>
      <p>- Ett gruppfoto kommer tas vid startpunkten n√§r t√§vlingstiden √§r ute.</p>
      <p>- SE TILL ATT VARA TILLBAKA I TID F√ñR GRUPPFOTOT</p>
    </div>

    <div style="text-align:center; margin-bottom: 20px;">
      <div id="timerDisplay"></div>
      <div id="pauseTimerDisplay"></div>
      <div id="checklistProgress">0% klart</div>
      <button id="startTimerBtn">Starta t√§vlingen</button>
      <button id="pauseBtn" disabled>Pausa 10 min</button>
      <button id="resetTimerBtn">Nollst√§ll timer</button>
      
    </div>

    <ul id="checklist" style="display:none;"></ul>
  </div>

  <script>
    // ---- Konfig ----
    const TOTAL_MINUTES = 6;          // Byt till 11 f√∂r test
    const PAUSE_MINUTES = 1;

    // ---- Element ----
    const checklist = document.getElementById('checklist');
    const checklistProgress = document.getElementById('checklistProgress');
    const timerDisplay = document.getElementById('timerDisplay');
    const pauseTimerDisplay = document.getElementById('pauseTimerDisplay');
    const startBtn = document.getElementById('startTimerBtn');
    const resetBtn = document.getElementById('resetTimerBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const releaseBtn = document.getElementById('releaseLocksBtn');

    // ---- State ----
    const totalDuration = TOTAL_MINUTES * 60 * 1000;
    const pauseDuration = PAUSE_MINUTES * 60 * 1000;
    let mainTimer = null;
    let pauseTimer = null;
    let timerStarted = false;
    let pausedOnce = false;

    // ---- Checklista ----
    const items = [
      'En gruppbild p√• det minsta utrymmet ni f√•r plats i',
      'Bygg n√•got tillsammans (Fri tolkning. G√∂r en m√§nsklig pyramid, bygg ett sandslott eller hitta en byggarbetsplats.)',
      'En ov√§ntad v√§nskap...!',
      'Alla i laget g√∂r samma sak (tex Alla i luften, alla p√• huk, walk like an egyptian...)',
      'En ‚Äúolycka‚Äù p√• semestern',
      'Havstema',
      'F√∂re & efter ‚Äì ta tv√• bilder bredvid varandra: en ‚Äúseri√∂s aff√§rsbild‚Äù och en ‚Äúsemesterbild‚Äù p√• samma plats.',
      'Skriv NORDLO i sanden p√• stranden och ta en gruppbild',
      'Kl√§m ihop n√•t j√§ttestort',
      'Det minsta och st√∂rsta ni hittar, som ryms i en hand',
      'G√∂r honn√∂r framf√∂r en font√§n!',
      'Krama en palm!',
      'G√∂r tummen upp framf√∂r Iglesia de San Rom√°n',
      'Turistf√§llan ‚Äì posera framf√∂r n√•got helt vardagligt (t.ex. en soptunna) som om det vore stadens st√∂rsta sev√§rdhet',
      'Alla √§r v√§nda bort fr√•n kameran',
      'Ta en gruppbild med en katt/hund/valfritt djur',
      'Peta p√• en motorcykel. En ska se glad ut, alla andra f√∂rskr√§ckta',
      'Ramla! (roliga gatan fram)',
      'Ha en livlig argumentation',
      'Spela fotboll',
      '√Ñt n√•t litet, men gapa s√• att det √§r n√•t j√§ttestort',
      '√Öterskapa skivomslaget till Beatles - Abbey road',
      'Tugga tuggummi och bl√•s en stor bubbla',
      'Leta upp en udda hatt och ta en bild med den'
    ];

    items.forEach((item,index)=>{
      const li = document.createElement('li');
      const checkbox = document.createElement('input');
      checkbox.type='checkbox';
      checkbox.id=`task${index+1}`;
      if(localStorage.getItem(checkbox.id)==='true') checkbox.checked=true;
      checkbox.addEventListener('change',()=>{
        localStorage.setItem(checkbox.id,checkbox.checked);
        updateChecklistProgress();
        if(checkbox.checked && /Mobi|Android/i.test(navigator.userAgent)){
          confetti({particleCount:600, spread:360, scalar:1.5, ticks:400,origin: { x: 0.5, y: 0.3 }});
        }
      });
      const label = document.createElement('label');
      label.htmlFor=checkbox.id;
      label.innerText=item;
      li.appendChild(checkbox);
      li.appendChild(label);
      checklist.appendChild(li);
    });

    function updateChecklistProgress(){
      const cb = checklist.querySelectorAll('input[type="checkbox"]');
      const total = cb.length;
      const checked = Array.from(cb).filter(x=>x.checked).length;
      checklistProgress.innerText = `${Math.round((checked/total)*100)}% klara`;
    }
    updateChecklistProgress();

    // ---- Hj√§lpfunktioner ----
    function formatTime(seconds){
      const m=Math.floor(seconds/60), s=seconds%60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }
    function preventReload(on){
      if(on){
        window.addEventListener('beforeunload', blockUnload);
      } else {
        window.removeEventListener('beforeunload', blockUnload);
      }
    }
    function blockUnload(e){ e.preventDefault(); e.returnValue=''; }
    function showChecklist(show){ checklist.style.display = show ? 'block' : 'none'; }

    function getNow(){ return Date.now(); }

    // Vi r√§knar huvudtid som: elapsed = (now - timerStart) - totalPaused
    // och sparar allt i localStorage s√• det √∂verlever reload.
    const LS = {
      timerStart: 'timerStart',
      totalPaused: 'totalPaused',
      pauseStart: 'pauseStart',
      pausedOnce: 'pausedOnce',
      fiveMinWarned: 'fiveMinWarned',
      doneWarned: 'doneWarned'
    };

    function getNum(key){ return Number(localStorage.getItem(key) || 0); }
    function setNum(key,val){ localStorage.setItem(key,String(val)); }
    function clr(key){ localStorage.removeItem(key); }

    // ---- Huvudtimer ----
    function startMainTick(){
      clearInterval(mainTimer);
      mainTimer = setInterval(()=>{
        const timerStart = getNum(LS.timerStart);
        const totalPaused = getNum(LS.totalPaused);
        const elapsed = Math.max(0, getNow() - timerStart - totalPaused);
        let remainingSec = Math.ceil((totalDuration - elapsed)/1000);

        // 5 min varning (en g√•ng)
        if(remainingSec === 300 && !localStorage.getItem(LS.fiveMinWarned)){
          localStorage.setItem(LS.fiveMinWarned,'1');
          if('vibrate' in navigator){ navigator.vibrate(10000); }
          alert('5 minuter kvar av t√§vlingen!');
        }

        // Slut
        if(remainingSec <= 0){
          remainingSec = 0;
          clearInterval(mainTimer);
          if(!localStorage.getItem(LS.doneWarned)){
            localStorage.setItem(LS.doneWarned,'1');
            if('vibrate' in navigator){ navigator.vibrate(10000); }
            alert('T√§vlingen √§r avslutad!');
          }
          // St√§da state
          clr(LS.pauseStart);
          clr(LS.pausedOnce);
          preventReload(false);
          pauseBtn.disabled = false; // f√§rg spelar ingen roll nu
          pauseBtn.style.backgroundColor = "#4CAF50";
          timerStarted = false;
        }
        timerDisplay.innerText = formatTime(remainingSec);
      }, 1000);
    }

    function startMain(){
      if(timerStarted) return;
      timerStarted = true;

      // UI
      startBtn.disabled = true;
      startBtn.style.backgroundColor = "#888";
      pauseBtn.disabled = false;
      pauseBtn.style.backgroundColor = "#4CAF50";
      showChecklist(true);
      preventReload(true);

      // Initiera tid om ny start
      if(!localStorage.getItem(LS.timerStart)){
        setNum(LS.timerStart, getNow());
        setNum(LS.totalPaused, 0);
        clr(LS.pauseStart);
        clr(LS.fiveMinWarned);
        clr(LS.doneWarned);
      }

      // l√§s pausflagga
      pausedOnce = localStorage.getItem(LS.pausedOnce) === 'true';

      startMainTick();
    }

    // ---- Paus ----
    function startPause(){
      if(!timerStarted) return;
      if(localStorage.getItem(LS.pauseStart)) return; // redan i paus
      if(localStorage.getItem(LS.pausedOnce) === 'true') return; // bara en g√•ng

      if(!confirm("OBS! Denna g√•r att anv√§nda endast en g√•ng!\n√Ñr du S√ÑKER p√• att du vill pausa?")) return;

      localStorage.setItem(LS.pausedOnce, 'true');
      pausedOnce = true;

      // UI
      pauseBtn.disabled = true;
      pauseBtn.style.backgroundColor = "#888";
      showChecklist(false);                 // üëà g√∂m checklistan under paus
      preventReload(true);

      // Starta paus
      setNum(LS.pauseStart, getNow());
      clearInterval(mainTimer);

      // Paustimer UI
      clearInterval(pauseTimer);
      let remaining = Math.ceil(pauseDuration/1000);
      pauseTimerDisplay.innerText = "Paus " + formatTime(remaining);
      pauseTimer = setInterval(()=>{
        remaining--;
        if(remaining <= 0){
          clearInterval(pauseTimer);
          pauseTimerDisplay.innerText = '';
          endPauseAndResume();
        } else {
          pauseTimerDisplay.innerText = "Paus " + formatTime(remaining);
        }
      }, 1000);
    }

    function endPauseAndResume(){
      const pauseStart = getNum(LS.pauseStart);
      if(pauseStart){
        const pauseElapsed = getNow() - pauseStart;
        const totalPaused = getNum(LS.totalPaused) + pauseElapsed;
        setNum(LS.totalPaused, totalPaused);
      }
      clr(LS.pauseStart);

      // Visa tillbaka checklistan
      showChecklist(true);

      // Forts√§tt huvudtimer utan att toggla timerStarted-flaggan
      startMainTick();
      preventReload(true);
    }

    // ---- Knappar ----
    startBtn.addEventListener('click', startMain);
    pauseBtn.addEventListener('click', startPause);

    // "Fuska inte"-knapp
    resetBtn.addEventListener('click', () => {
      alert("APP-APP-APP!\nF√∂rs√∂k inte fuska!\n\nEtt meddelande har skickats till ledningen att ni tryckt p√• denna knapp!");
    });

    // Nollst√§ll allt till ursprungsl√§get
    releaseBtn.addEventListener('click', ()=>{
      if(!confirm("Vill du sl√§ppa alla sp√§rrar och nollst√§lla?")) return;

      clearInterval(mainTimer);
      clearInterval(pauseTimer);
      // Rensa all timer/paus-state
      clr(LS.timerStart);
      clr(LS.totalPaused);
      clr(LS.pauseStart);
      clr(LS.pausedOnce);
      clr(LS.fiveMinWarned);
      clr(LS.doneWarned);

      // √Öterst√§ll UI
      timerStarted = false;
      pausedOnce = false;
      timerDisplay.innerText = formatTime(TOTAL_MINUTES*60);
      pauseTimerDisplay.innerText = '';
      showChecklist(false);
      preventReload(false);

      startBtn.disabled = false;
      startBtn.style.backgroundColor = "#4CAF50";
      pauseBtn.disabled = true;
      pauseBtn.style.backgroundColor = "#888";

      // Avmarkera och nollst√§ll checklista-procent (beh√•ll uppgiftstext)
      const checkboxes = checklist.querySelectorAll('input[type="checkbox"]');
      checkboxes.forEach(cb=>{
        cb.checked = false;
        localStorage.setItem(cb.id, 'false');
      });
      updateChecklistProgress();
    });

    // ---- Init vid inl√§sning (√•terst√§ll fr√•n localStorage) ----
    (function initFromStorage(){
      // Om det finns timerStart √§r vi mitt i ett race
      if(localStorage.getItem(LS.timerStart)){
        timerStarted = true;
        startBtn.disabled = true;
        startBtn.style.backgroundColor = "#888";
        pauseBtn.disabled = localStorage.getItem(LS.pausedOnce)==='true';
        pauseBtn.style.backgroundColor = pauseBtn.disabled ? "#888" : "#4CAF50";

        const inPause = !!localStorage.getItem(LS.pauseStart);
        showChecklist(!inPause);
        preventReload(true);

        if(inPause){
          // R√§kna ner kvarvarande paus utifr√•n lagrad start
          const elapsed = getNow() - getNum(LS.pauseStart);
          let remaining = Math.max(0, Math.ceil((pauseDuration - elapsed)/1000));
          pauseTimerDisplay.innerText = remaining>0 ? ("Paus " + formatTime(remaining)) : '';
          clearInterval(pauseTimer);
          if(remaining>0){
            pauseTimer = setInterval(()=>{
              remaining--;
              if(remaining<=0){
                clearInterval(pauseTimer);
                pauseTimerDisplay.innerText='';
                endPauseAndResume();
              }else{
                pauseTimerDisplay.innerText="Paus " + formatTime(remaining);
              }
            },1000);
          }else{
            endPauseAndResume();
          }
        }else{
          startMainTick();
        }
      }else{
        // Ursprungsl√§ge
        timerDisplay.innerText = formatTime(TOTAL_MINUTES*60);
        showChecklist(false);
        preventReload(false);
        pauseBtn.disabled = true;
        pauseBtn.style.backgroundColor = "#888";
      }
    })();
  </script>
</body>

</html>
